@startuml
title Sequence Diagram: test_startup_and_shutdown_happy_path
autonumber
skinparam responseMessageBelowArrow true
"TestSystemLifecycleService" -> "EventBus" : **SUBSCRIBE** Subscribe to 'systemready'
"TestSystemLifecycleService" -> "EventBus" : **SUBSCRIBE** Subscribe to 'systemstartupfailed'
"TestSystemLifecycleService" -> "EventBus" : **SUBSCRIBE** Subscribe to 'systemshuttingdown'
"TestSystemLifecycleService" -> "EventBus" : **SUBSCRIBE** Subscribe to 'systemshutdowncomplete'
"TestSystemLifecycleService" -> "SystemStartupApplicationService" : **CALL** startup_system(verify_hardware=True, load_last_calibration=True)
note right
Data: {
  "verify_hardware": true,
  "load_last_calibration": true
}
end note
"EventBus" -> "SystemReadyEvent" : **RECEIVE** Handler received SystemReadyEvent
note right
Data: {
  "event_type": "SystemReadyEvent"
}
end note
"TestSystemLifecycleService" -> "SystemStartupApplicationService" : **ASSERT** StartupResult.success should be True
note right
Expect: True
Got: True
end note
"TestSystemLifecycleService" -> "FakeHardwareInitializer" : **ASSERT** Hardware should be initialized and verified
note right
Data: {
  "initialized": true,
  "verified": true
}
Expect: {'initialized': True, 'verified': True}
Got: {'initialized': True, 'verified': True}
end note
"TestSystemLifecycleService" -> "FakeCalibrationService" : **ASSERT** Calibration should be loaded
note right
Expect: True
Got: True
end note
"TestSystemLifecycleService" -> "EventBus" : **ASSERT** SystemReadyEvent should have been published
note right
Expect: True
Got: True
end note
"TestSystemLifecycleService" -> "SystemShutdownApplicationService" : **CALL** shutdown_system(save_state=False)
note right
Data: {
  "save_state": false
}
end note
"EventBus" -> "SystemShuttingDownEvent" : **RECEIVE** Handler received SystemShuttingDownEvent
note right
Data: {
  "event_type": "SystemShuttingDownEvent"
}
end note
"EventBus" -> "SystemShutdownCompleteEvent" : **RECEIVE** Handler received SystemShutdownCompleteEvent
note right
Data: {
  "event_type": "SystemShutdownCompleteEvent"
}
end note
"TestSystemLifecycleService" -> "SystemShutdownApplicationService" : **ASSERT** ShutdownResult.success should be True
note right
Expect: True
Got: True
end note
"TestSystemLifecycleService" -> "FakeHardwareInitializer" : **ASSERT** Hardware should be closed after shutdown
note right
Expect: True
Got: True
end note
"TestSystemLifecycleService" -> "EventBus" : **ASSERT** SystemShuttingDownEvent and SystemShutdownCompleteEvent should be published
note right
Expect: True
Got: True
end note
@enduml