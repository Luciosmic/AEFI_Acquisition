@startuml
title Sequence Diagram: test_startup_failure_when_hardware_verification_fails
autonumber
skinparam responseMessageBelowArrow true
"TestSystemLifecycleService" -> "EventBus" : **SUBSCRIBE** Subscribe to 'systemready'
"TestSystemLifecycleService" -> "EventBus" : **SUBSCRIBE** Subscribe to 'systemstartupfailed'
"TestSystemLifecycleService" -> "EventBus" : **SUBSCRIBE** Subscribe to 'systemshuttingdown'
"TestSystemLifecycleService" -> "EventBus" : **SUBSCRIBE** Subscribe to 'systemshutdowncomplete'
"TestSystemLifecycleService" -> "SystemStartupApplicationService" : **CALL** startup_system() with failing verify_all()
note right
Data: {
  "verify_hardware": true,
  "load_last_calibration": true
}
end note
"EventBus" -> "SystemStartupFailedEvent" : **RECEIVE** Handler received SystemStartupFailedEvent
note right
Data: {
  "event_type": "SystemStartupFailedEvent"
}
end note
"TestSystemLifecycleService" -> "SystemStartupApplicationService" : **ASSERT** StartupResult.success should be False when verification fails
note right
Expect: False
Got: False
end note
"TestSystemLifecycleService" -> "FailingHardwareInitializer" : **ASSERT** Hardware should be initialized and verified even on failure
note right
Data: {
  "initialized": true,
  "verified": true
}
Expect: {'initialized': True, 'verified': True}
Got: {'initialized': True, 'verified': True}
end note
"TestSystemLifecycleService" -> "FakeCalibrationService" : **ASSERT** Calibration should NOT be loaded when verification fails
note right
Expect: False
Got: False
end note
"TestSystemLifecycleService" -> "EventBus" : **ASSERT** SystemStartupFailedEvent should have been published
note right
Expect: True
Got: True
end note
@enduml