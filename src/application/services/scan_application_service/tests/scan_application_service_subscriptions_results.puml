@startuml
title Sequence Diagram: test_subscriptions
autonumber
skinparam responseMessageBelowArrow true
"Test" -> "ScanApplicationService" : **CREATE** Setup service and ports
"Test" -> "EventBus" : **SUBSCRIBE** Subscribe to scan events
"Test" -> "ScanApplicationService" : **START** Start subscription test
"Test" -> "ScanApplicationService" : **CALL** Subscribe to updates
"Test" -> "ScanApplicationService" : **CALL** Subscribe to completion
"EventBus" -> "Test" : **RECEIVE** Received ScanStarted
note right
Data: {
  "event": "ScanStarted",
  "scan_id": "313068c8-88b4-4cb8-8116-aec6e97501f0",
  "pattern": "RASTER"
}
end note
"EventBus" -> "Test" : **RECEIVE** Received ScanPointAcquired
note right
Data: {
  "event": "ScanPointAcquired",
  "point_index": 0,
  "position": {
    "x": 0.0,
    "y": 0.0
  },
  "measurement": {
    "x_in_phase": 0.1,
    "x_quad": 0.0
  }
}
end note
"EventBus" -> "Test" : **RECEIVE** Received ScanPointAcquired
note right
Data: {
  "event": "ScanPointAcquired",
  "point_index": 1,
  "position": {
    "x": 1.0,
    "y": 0.0
  },
  "measurement": {
    "x_in_phase": 0.2,
    "x_quad": 0.0
  }
}
end note
"EventBus" -> "Test" : **RECEIVE** Received ScanPointAcquired
note right
Data: {
  "event": "ScanPointAcquired",
  "point_index": 2,
  "position": {
    "x": 0.0,
    "y": 1.0
  },
  "measurement": {
    "x_in_phase": 0.30000000000000004,
    "x_quad": 0.0
  }
}
end note
"EventBus" -> "Test" : **RECEIVE** Received ScanPointAcquired
note right
Data: {
  "event": "ScanPointAcquired",
  "point_index": 3,
  "position": {
    "x": 1.0,
    "y": 1.0
  },
  "measurement": {
    "x_in_phase": 0.4,
    "x_quad": 0.0
  }
}
end note
"EventBus" -> "Test" : **RECEIVE** Received ScanCompleted
note right
Data: {
  "event": "ScanCompleted",
  "scan_id": "313068c8-88b4-4cb8-8116-aec6e97501f0",
  "total_points": 4
}
end note
"Test" -> "ScanApplicationService" : **ASSERT** Verify updates received
note right
Expect: 4
Got: 4
end note
"Test" -> "ScanApplicationService" : **ASSERT** Verify completion received
note right
Expect: 1
Got: 1
end note
@enduml