@startuml
title Sequence Diagram: test_start_scan_flow
autonumber
skinparam responseMessageBelowArrow true
"Test" -> "ScanPresenter" : **CREATE** Initialize Presenter
"ScanPresenter" -> "ScanApplicationService" : **CALL** Call subscribe_to_scan_updates
note right
Data: {
  "args": [
    "<bound method ScanPresenter._on_domain_event of <interface.ui_2d_scan.presenter_2d_scan.ScanPresenter object at 0x102d5e170>>"
  ],
  "kwargs": {}
}
end note
"ScanApplicationService" --> "ScanPresenter" : **RETURN** Return from subscribe_to_scan_updates
note right
Data: {
  "result": "<MagicMock name='mock.subscribe_to_scan_updates()' id='4340822240'>"
}
end note
"ScanPresenter" -> "ScanApplicationService" : **CALL** Call subscribe_to_scan_completion
note right
Data: {
  "args": [
    "<bound method ScanPresenter._on_domain_event of <interface.ui_2d_scan.presenter_2d_scan.ScanPresenter object at 0x102d5e170>>"
  ],
  "kwargs": {}
}
end note
"ScanApplicationService" --> "ScanPresenter" : **RETURN** Return from subscribe_to_scan_completion
note right
Data: {
  "result": "<MagicMock name='mock.subscribe_to_scan_completion()' id='4340823248'>"
}
end note
"Test" -> "ScanPresenter" : **START** Start scan flow test
"UI" -> "ScanPresenter" : **CALL** start_scan
note right
Data: {
  "x_min": 0,
  "x_max": 1,
  "x_nb_points": 2,
  "y_min": 0,
  "y_max": 1,
  "y_nb_points": 2,
  "scan_pattern": "RASTER"
}
end note
"ScanPresenter" -> "ScanApplicationService" : **CALL** Call execute_scan
note right
Data: {
  "args": [
    "Scan2DConfigDTO(x_min=0.0, x_max=1.0, y_min=0.0, y_max=1.0, x_nb_points=2, y_nb_points=2, scan_pattern='RASTER', stabilization_delay_ms=10, averaging_per_position=1, uncertainty_vol...
end note
"ScanApplicationService" --> "ScanPresenter" : **RETURN** Return from execute_scan
note right
Data: {
  "result": "<MagicMock name='mock.execute_scan()' id='4340825600'>"
}
end note
"ScanApplicationService" -> "ScanPresenter" : **PUBLISH** ScanStarted Event
"ScanPresenter" -> "UI" : **EMIT** Signal scan_started
note right
Data: {
  "args": [
    "565c0a82-38ef-4496-aa48-b725af1a7a68",
    "{'pattern': 'RASTER', 'points': 4, 'x_min': 0, 'x_max': 1, 'x_nb_points': 2, 'y_min': 0, 'y_max': 1, 'y_nb_points': 2}"
  ]
}
end note
"ScanApplicationService" -> "ScanPresenter" : **PUBLISH** ScanPointAcquired Event
"ScanPresenter" -> "UI" : **EMIT** Signal scan_point_acquired
note right
Data: {
  "args": [
    "{'x': 0, 'y': 0, 'value': {'x_in_phase': 1.0, 'x_quadrature': 0.0, 'y_in_phase': 0.0, 'y_quadrature': 0.0, 'z_in_phase': 0.0, 'z_quadrature': 0.0}, 'index': 0}"
  ]
}
end note
"ScanApplicationService" -> "ScanPresenter" : **PUBLISH** ScanCompleted Event
"ScanPresenter" -> "UI" : **EMIT** Signal scan_completed
note right
Data: {
  "args": [
    "565c0a82-38ef-4496-aa48-b725af1a7a68",
    "4"
  ]
}
end note
@enduml