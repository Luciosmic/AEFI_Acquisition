@startuml
title Sequence Diagram: test_digest_orchestration_flow
autonumber
skinparam responseMessageBelowArrow true
"Test" -> "InMemoryEventBus" : **CREATE** Initialize fresh bus
"Test" -> "InMemoryEventBus" : **SUBSCRIBE** Subscribe A
note right
Data: {
  "event": "scan.started"
}
end note
"Test" -> "InMemoryEventBus" : **SUBSCRIBE** Subscribe B
note right
Data: {
  "event": "scan.started"
}
end note
"Test" -> "InMemoryEventBus" : **PUBLISH** Publish scan.started
note right
Data: {
  "payload": {
    "scan_id": "demo-123",
    "status": "started"
  }
}
end note
"SubscriberA" -> "InMemoryEventBus" : **RECEIVE** Received event
note right
Data: {
  "data": {
    "scan_id": "demo-123",
    "status": "started"
  }
}
end note
"SubscriberB" -> "InMemoryEventBus" : **RECEIVE** Received event
note right
Data: {
  "data": {
    "scan_id": "demo-123",
    "status": "started"
  }
}
end note
"Test" -> "InMemoryEventBus" : **ASSERT** Verify orchestration
note right
Expect: [('A', {'scan_id': 'demo-123', 'status': 'started'}), ('B', {'scan_id': 'demo-123', 'status': 'started'})]
Got: [('A', {'scan_id': 'demo-123', 'status': 'started'}), ('B', {'scan_id': 'demo-123', 'status': 'started'})]
end note
@enduml