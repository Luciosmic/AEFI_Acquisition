@startuml Scan Application Service - Détaillé
!define RECTANGLE class

skinparam classAttributeIconSize 0
skinparam backgroundColor #FEFEFE

package "Application Layer" {
    class ScanApplicationService {
      - _trajectory_service: ScanTrajectoryService
      - _motion_port: IMotionPort
      - _acquisition_port: IAcquisitionPort
      - _export_port: IExportPort
      
      ' === Use Cases (Orchestration) ===
      + execute_scan(config: Scan2DConfigDTO, export: ExportConfigDTO) -> bool
      + pause_scan() -> void
      + resume_scan() -> void
      + cancel_scan() -> void
      
      ' === Queries ===
      + get_status() -> ScanStatusDTO
    }
}

package "Domain Layer" {
    class ScanTrajectoryService {
      ' === Pure Logic ===
      + validate_config(config: StepScanConfig) -> ValidationResult
      + generate_trajectory(config: StepScanConfig) -> List[Position2D]
    }
    
    class StepScanConfig {
        + scan_zone: ScanZone
        + scan_mode: ScanMode
    }
}

package "Infrastructure Layer" {
    class CSVExporter {
        + write_point(data)
    }
    class MotionAdapter {
        + move_to(position)
    }
    class AcquisitionAdapter {
        + acquire_sample()
    }
}

' === Relations ===
ScanApplicationService --> ScanTrajectoryService : "uses for logic"
ScanApplicationService --> MotionAdapter : "orchestrates"
ScanApplicationService --> AcquisitionAdapter : "orchestrates"
ScanApplicationService --> CSVExporter : "orchestrates"

note right of ScanApplicationService
  **Application Service**
  
  **Responsabilités:**
  - Orchestration complète (Boucle de scan)
  - Gestion des ports (Motion, Acquisition, Export)
  - Gestion du cycle de vie (Pause/Resume)
  - Conversion DTOs
  
  **Orchestration:**
  1. Récupère trajectoire (Domain)
  2. Boucle sur les points:
     - Move (Motion Port)
     - Acquire (Acquisition Port)
     - Export (Export Port)
end note

note bottom of ScanTrajectoryService
  **Domain Service (Pure)**
  
  - Calcul pur de trajectoire
  - Validation de configuration
  - AUCUN accès hardware/IO
  - Totalement déterministe
end note

@enduml
