@startuml Application Layer - Vue Générale

!define RECTANGLE class

skinparam packageStyle rectangle
skinparam backgroundColor #FEFEFE
skinparam componentStyle rectangle

' === COUCHES ===
package "Presentation Layer (GUI)" as GUI {
  [EFImagingBench_GUI]
}

package "Application Layer (Services)" as APP {
  note as N1
    **Remplace progressivement MetaManager**
    - Découpage en services métier
    - Chaque service = responsabilité unique
    - Migration progressive sans casser l'existant
  end note
  
  [MotionService]
  [ScanService]
  [DeviceExcitationConfigService]
  [DeviceAcquisitionConfigService]
  [DataAcquisitionService]
}

' === Phase de transition ===
package "Legacy (À supprimer)" as LEGACY {
  [MetaManager] <<deprecated>>
}

' === RELATIONS GUI -> APPLICATION (Nouveau) ===
GUI --> MotionService : "Mouvement axes"
GUI --> ScanService : "Scans 2D"
GUI --> DeviceExcitationConfigService : "Config DDS"
GUI --> DeviceAcquisitionConfigService : "Config ADC + Export"
GUI --> DataAcquisitionService : "Acquisition données"

' === RELATIONS GUI -> LEGACY (Temporaire) ===
GUI ..> MetaManager : "<<legacy>>\nà migrer"

note right of APP
  **5 Services de la couche Application:**
  
  **MotionService**
  - move_to(), home(), stop()
  - Configuration vitesse axes
  - Validation positions
  
  **ScanService**
  - execute_scan_2d()
  - Génération trajectoires
  - Coordination scan + export
  
  **DeviceExcitationConfigService**
  - Configuration DDS (4 canaux)
  - Directions d'excitation
  - Validation paramètres
  
  **DeviceAcquisitionConfigService**
  - Configuration ADC (4 canaux)
  - Configuration export CSV
  - Validation paramètres ADC
  
  **DataAcquisitionService** (NOUVEAU)
  - Contrôle acquisition (start/stop)
  - Flux de données temps réel
  - Moyennage échantillons
  - Statistiques acquisition
  
  **Stratégie de migration:**
  1. Créer services vides
  2. Copier logique MetaManager → Services
  3. Migrer GUI progressivement
  4. Supprimer MetaManager à la fin
end note

note bottom of LEGACY
  **MetaManager (deprecated)**
  
  À découper en 5 services :
  - move_to/home/stop → MotionService
  - inject_scan_batch → ScanService
  - update_configuration DDS → DeviceExcitationConfigService
  - update_configuration ADC/export → DeviceAcquisitionConfigService
  - start/stop acquisition, data flow → DataAcquisitionService
  
  À supprimer après migration complète
end note

@enduml
