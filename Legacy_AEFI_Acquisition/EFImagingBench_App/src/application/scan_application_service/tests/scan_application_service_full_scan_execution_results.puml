@startuml
title Sequence Diagram: test_full_scan_execution
autonumber
skinparam responseMessageBelowArrow true
"Test" -> "ScanApplicationService" : **CREATE** Setup service and ports
"Test" -> "EventBus" : **SUBSCRIBE** Subscribe to scan events
"Test" -> "ScanApplicationService" : **START** Start full scan execution test
"Test" -> "Scan2DConfigDTO" : **CREATE** Create scan config
note right
Data: {
  "pattern": "RASTER"
}
end note
"Test" -> "ScanApplicationService" : **COMMAND** Execute scan
"EventBus" -> "Test" : **RECEIVE** Received ScanStarted
note right
Data: {
  "event": "ScanStarted",
  "scan_id": "4369312a-a915-47c1-b170-7968ec8028b0",
  "pattern": "RASTER"
}
end note
"EventBus" -> "Test" : **RECEIVE** Received ScanPointAcquired
note right
Data: {
  "event": "ScanPointAcquired",
  "point_index": 0,
  "position": {
    "x": 0.0,
    "y": 0.0
  },
  "measurement": {
    "x_in_phase": 0.1,
    "x_quad": 0.0
  }
}
end note
"EventBus" -> "Test" : **RECEIVE** Received ScanPointAcquired
note right
Data: {
  "event": "ScanPointAcquired",
  "point_index": 1,
  "position": {
    "x": 1.0,
    "y": 0.0
  },
  "measurement": {
    "x_in_phase": 0.2,
    "x_quad": 0.0
  }
}
end note
"EventBus" -> "Test" : **RECEIVE** Received ScanPointAcquired
note right
Data: {
  "event": "ScanPointAcquired",
  "point_index": 2,
  "position": {
    "x": 0.0,
    "y": 1.0
  },
  "measurement": {
    "x_in_phase": 0.30000000000000004,
    "x_quad": 0.0
  }
}
end note
"EventBus" -> "Test" : **RECEIVE** Received ScanPointAcquired
note right
Data: {
  "event": "ScanPointAcquired",
  "point_index": 3,
  "position": {
    "x": 1.0,
    "y": 1.0
  },
  "measurement": {
    "x_in_phase": 0.4,
    "x_quad": 0.0
  }
}
end note
"EventBus" -> "Test" : **RECEIVE** Received ScanCompleted
note right
Data: {
  "event": "ScanCompleted",
  "scan_id": "4369312a-a915-47c1-b170-7968ec8028b0",
  "total_points": 4
}
end note
"Test" -> "ScanApplicationService" : **ASSERT** Verify execution success
note right
Expect: True
Got: True
end note
"Test" -> "EventBus" : **ASSERT** Verify ScanStarted event
"Test" -> "EventBus" : **ASSERT** Verify ScanCompleted event
"Test" -> "EventBus" : **ASSERT** Verify points acquired
note right
Expect: 4
Got: 4
end note
"Test" -> "MotionPort" : **ASSERT** Verify move history
note right
Expect: 4
Got: 4
end note
@enduml