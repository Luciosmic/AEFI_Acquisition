@startuml
title Sequence Diagram: test_scan_export_flow
autonumber
skinparam responseMessageBelowArrow true
"Test" -> "HDF5Repository" : **CREATE** Init at tests/scan_export_with_event_bus_integration_tests
note right
Data: {
  "path": "/Users/luis/Library/CloudStorage/Dropbox/Luis/1 PROJETS/1 - THESE/Ressources/ExperimentalData_ASSOCE/AEFI_Acquisition/Legacy_AEFI_Acquisition/EFImagingBench_App/src/application/scan_appli...
end note
"Test" -> "EventBus" : **CREATE** Init InMemoryEventBus
"Test" -> "AcquisitionHandler" : **CREATE** Init with Repository
"Test" -> "EventBus" : **SUBSCRIBE** Handler subscribes to scanpointacquired
"Test" -> "ScanService" : **CREATE** Init with Ports & Bus
"Test" -> "ScanService" : **START** Start Integration Test
"Test" -> "ScanService" : **COMMAND** Execute Scan
note right
Data: {
  "pattern": "RASTER",
  "grid": "2x2"
}
end note
"Test" -> "ScanService" : **ASSERT** Check execution success
note right
Expect: True
Got: True
end note
"Test" -> "FileSystem" : **QUERY** Find generated HDF5 file
"Test" -> "FileSystem" : **ASSERT** Check file count
note right
Expect: 1
Got: 1
end note
"Test" -> "HDF5Repository" : **QUERY** Load data from file
note right
Data: {
  "scan_id": "4150a302-a3f0-4138-b7f1-50e3190d4a3d"
}
end note
"Test" -> "HDF5Repository" : **ASSERT** Check sample count
note right
Expect: 4
Got: 4
end note
@enduml